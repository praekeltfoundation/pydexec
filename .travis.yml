sudo: required
services:
    - docker
# Haven't needed this before to get Docker to work (???)
# https://github.com/travis-ci/travis-ci/issues/5448
dist: trusty

language: python
env:
  - DOCKER_IMAGE=praekeltfoundation/python-base
  - DOCKER_IMAGE=praekeltfoundation/python3-base
  - DOCKER_IMAGE=praekeltfoundation/pypy-base

install:
  - docker pull $DOCKER_IMAGE
  - pip install codecov

before_script:
  - |
    SCRIPT="set -x \
      && pip install --no-cache -r requirements-dev.txt \
      && pytest --cov --cov-report term --cov-report xml \
      && flake8 ."
script:
  # Run tests inside a container to get a vaguely consistent environment
  - docker run --rm -v "$(pwd)":/pydexec -w /pydexec $DOCKER_IMAGE /bin/sh -c "$SCRIPT"

after_success:
  - codecov
